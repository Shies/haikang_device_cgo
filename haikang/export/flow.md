# 工作流分享整理

## 导航

- [版本](#版本)
- [说明](#说明)
- [协议约定](#协议约定)
  - [分支管理](#分支管理)
  - [容器管理](#容器管理)
  - [内网穿透](#内网穿透)
  - [代码仓库](#代码仓库)
  - [服务监控](#服务监控)
  - [域名解析](#域名解析)
  - [持续集成/持续交付](#持续集成/持续交付)


## 版本

| 版本   |  时间 |    备注     |
| ----- | -------: | :-------: |
| 1.0 | 2021.11.09 | 初始化1.0文档 |

## 说明

此文档面向 **工作流分享**  的后端（辜凯）整理。

## 协议约定

### 分支管理

1. GiT操作指南
  * 具体自行查阅

2. GIT项目协作
  * master 开发分支
  * dev    测试分支
  * pre    预发布分支
  * prod   生产分支

3. GIT协作管理
  * 单人开发项目可以在master分支进行开发
  * 多个开发项目可以自定义feature业务分支，最终合并到master均可
  * 遗留问题可以自定义hotfix业务分支，用于专门解决漏洞和补丁修复

### 容器管理

1. 项目目录下创建.gitlab.ci.yml文件
  * 镜像脚本
  * 生成镜像
  * 运行镜像

2. 环境隔离（dockerfile）
  * dev 测试环境，比如：110
  * pre 预发布环境，比如：228
  * prod 生产环境，比如：31

3. 平滑启动（在不停掉旧服务过程中，启动新的服务）
  * 具体登录hub.io，进行操作即可
  * 人工启动、重启、删除，安全审计等

### 内网穿透

1. 远程控制/远程管理
  * Win环境下可使用NPC进行连接管理
  * Mac环境下可使用TeamViewer进行连接管理
  * Linux环境下可使用XShell进行连接管理

### 代码仓库

1. GITlab操作指南
  * 具体自行查阅，或者官方下载文档

2. 代码审计
  * 创建Merge Requests
  * 代码格式化, 单元测试覆盖率，压力测试覆盖率
  * 逻辑隔离，分层规范等

3. 发布监控
  * 合并Merge Requests
  * 集成管理（ci/cd）中查看发布状态
  * 发布管道（piplines）中查看发布日志

### 服务监控

1. 系统层监控
  * 腾讯云进行管理

2. 应用层监控
  * Etcd监听健康状态，服务是否存活
  * Consul服务注册/发现，当然还可以使用Zookeeper

3. 业务层监控
  * 降级、熔断，gLog断点等策略

### 域名解析

1. Main启动服务
2. Nginx配置服务器基础信息
3. 腾讯云CName到服务器

### 持续集成/持续交付

1. supervisor管理进程
2. ops（操作机）拉取项目持续集成install bin
3. 启动cmd/bin
4. jenkins构建项目生成version, 根据version pull拉取到中转机
5. ops（操作机）绑定version, 再从中转机rsync到不同到机器上